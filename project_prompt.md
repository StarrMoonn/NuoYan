# VTI-Elastic 项目提示文档

## 项目概述
VTI-Elastic 是一个用于垂直横向各向同性(VTI)介质中弹性波传播模拟与全波形反演(FWI)的MATLAB框架。该项目实现了完整的正演模拟、伴随状态方法梯度计算和多种优化算法，用于地震数据处理和地下结构成像。

## 核心功能
1. **波场模拟**
   - 实现了VTI介质中的弹性波传播模拟
   - 支持PML吸收边界条件
   - 包含速度场(vx, vy)和应力场(sigmaxx, sigmayy, sigmaxy)的计算
   - 提供多种计算模式：纯CPU、CPU-MEX加速、SIMD加速

2. **全波形反演(FWI)**
   - 实现了完整的FWI工作流
   - 基于伴随状态方法计算梯度
   - 支持多种目标函数(波形残差L2范数、互相关残差)
   - 提供多种优化算法(梯度下降法、L-BFGS法、Fletcher-Reeves共轭梯度法)

## 项目结构
- **`core/`**: 核心功能实现
  - `VTI_WaveFieldSolver.m`: 波场求解器主类
  - `VTI_SingleShotModeling.m`: 单炮正演模拟
  - `VTI_Adjoint.m`: 伴随方程求解
  - `VTI_Gradient.m`: 梯度计算
  - `VTI_FWI.m`: 全波形反演主控制模块

- **`optimizers/`**: 优化算法实现
  - `BaseOptimizer.m`: 优化器基类
  - `GradientDescentOptimizer.m`: 梯度下降法
  - `LBFGSOptimizer.m`: L-BFGS法
  - `FletcherReevesCGOptimizer.m`: Fletcher-Reeves共轭梯度法
  - `CGOptimizer.m`: 共轭梯度法基类

- **`src/`**: C++/MEX源代码
  - 包含加速关键计算的MEX函数实现

- **`tools/`**: 工具函数
  - `aniso_vti.m`: VTI模型参数生成脚本

- **`unit_test/`**: 单元测试
  - 各个模块的测试案例

- **`data/`**: 数据文件夹
  - `model/`: 模型数据
  - `output/`: 计算结果输出

## 技术特点
1. **差分方案**
   - 采用二阶交错网格有限差分方法
   - 高效实现VTI介质中的波动方程

2. **边界条件**
   - 使用CPML(Convolutional Perfectly Matched Layer)完美匹配层
   - 有效抑制人工边界反射

3. **计算优化**
   - 提供多种计算模式(CPU, MEX, SIMD)
   - 针对大规模计算进行了内存优化

4. **VTI参数体系**
   - 基于完整的弹性参数集(c11, c13, c33, c44, rho)
   - 支持复杂VTI介质模型

## 模型参数
VTI介质模型基于以下参数：
- `c11`, `c13`, `c33`, `c44`: VTI介质的弹性常数
- `rho`: 密度
- `epsilon`, `delta`: Thomsen参数(在工具中用于模型生成)

## 代码修改注意事项
1. **保持数组维度一致**
   - 模型参数和波场变量的维度必须匹配
   - 注意MATLAB的列优先存储与代码中的索引关系

2. **内存管理**
   - 大规模波场计算时注意内存使用
   - 对于完整波场存储，可考虑磁盘存储模式

3. **边界条件维护**
   - 修改波场更新代码时需同步考虑PML边界条件
   - PML参数调整需谨慎，影响数值稳定性

4. **计算模式兼容**
   - 修改核心计算代码时需考虑所有计算模式的兼容性
   - MEX函数修改需重新编译相应模块

5. **优化算法参数**
   - 不同优化算法有特定参数设置，修改时需参考相应文档
   - 步长和收敛判断标准对优化过程至关重要

## 待优化功能
1. **实际数据处理**
   - 集成SEG-Y格式数据读取功能
   - 实现数据预处理和质量控制

2. **震源子波提取**
   - 从实际数据中反演提取震源子波
   - 实现自适应时窗处理

3. **目标函数优化**
   - 实现基于包络的伴随源计算
   - 添加包络归一化的互相关计算

4. **GPU加速**
   - 为计算密集型任务添加GPU加速支持

## 参考资料
- VTI介质理论基础可参考Thomsen(1986)的经典论文
- 伴随状态方法实现参考Tromp et al.(2005)和Plessix(2006)
- 数值模拟方法可参考Virieux(1986)和Robertsson et al.(1994) 