%% cutdata3 - 基于震源位置的地震数据时窗处理函数
%
% 功能说明：
%   根据震源位置对地震数据进行时窗处理，
%   通过斜率控制的时间窗口消除非直达波等无用信息。
%
% 输入参数：
%   seis2 - 三维地震数据 [时间 x 道数 x 炮数]
%   sxx   - 震源位置数组
%   ishot - 当前炮号
%
% 输出参数：
%   seist - 处理后的二维地震记录 [时间 x 道数]
%
% 加窗处理：
% 时间 ↓     偏移距 →
% 0   ┌───────────────┐
%     │///    ▲    \\\│  ▲ = 震源位置
%     │///   / \   \\\│
%     │///  /   \  \\\│  /// = 置零区域
%     │/// /     \ \\\│
%     │///         \\\│
% nt  └───────────────┘
%
% 处理效果：
% 时间 ↓     偏移距 →
% 0   ┌───────────────┐
%     │       ▲       │
%     │      / \      │  保留主要的
%     │     /   \     │  直达波信号
%     │    0     0    │
%     │   0       0   │  0 = 置零区域
% nt  └───────────────┘

%  m=1000;  % 时间窗口长度（固定值）
% [m,n]=size(seis);  % m是总时间采样点数

% 这个窗口：
% - 不是整个记录长度(nt)
% - 只处理前1000个时间采样点
% - 后面的数据保持不变
%
% 注意事项：
%   1. 边界震源(sx<=5或sx>=640)使用不同的处理参数
%   2. 时窗斜率由参数k2控制
%   3. 时窗外的数据置零
%

function [seist]=cutdata3(seis2,sxx,ishot)
% 提取当前炮的数据
seis=seis2(:,:,ishot);
sx=sxx(ishot);
[m,n]=size(seis);
seist=seis;

% 边界震源的处理（sx<=5或sx>=640）
if sx<=5||sx>=640
    m=1000;     % 时间窗口长度
    k2=6;       % 时窗斜率参数
    % 应用斜率时窗
    for i=1:m
        for j=1:n
            % 斜率控制的时窗，窗外数据置零
            if i<(k2*abs(sx-j))
                seist(i,j)=0;
            end
        end
    end

% 非边界震源的处理
else
    m=1000;     % 时间窗口长度
    k2=7;       % 时窗斜率参数（略大于边界情况）
    % 处理震源左侧数据
    for i=1:m
        for j=1:(sx-5)
            if i<(k2*abs(sx-j))
                seist(i,j)=0;
            end
        end
        % 处理震源右侧数据
        for j=(sx+5):n
            if i<(k2*abs(sx-j))
                seist(i,j)=0;
            end
        end
    end
end

end

% % 时间窗就是在时间-空间域上的一个"框"
% % 框内的数据保留，框外的数据置零或衰减
% 目的：
% - 去除无用信号（如多次波、面波）
% - 突出有用信号（如直达波、反射波）
% - 减少计算量
% % 以cutdata3.m为例
% for i=1:m        % i是时间采样点
%     for j=1:n    % j是道号
%         if i<(k2*abs(sx-j))  % 斜率控制的窗函数
%             seist(i,j)=0;    % 窗外数据置零
%         end
%     end
% end

% 窗函数类型：
% 1. 斜率窗（如本例）
% 2. 矩形窗
% 3. 高斯窗
% 4. 汉宁窗
% 等等...